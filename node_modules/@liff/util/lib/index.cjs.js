"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@liff/logger"),r=require("tslib"),t=require("@liff/consts");function n(e){return window.atob(e.replace(/-/g,"+").replace(/_/g,"/"))}var o={decode:n,encode:function(e){return window.btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},decodeUnicode:function(e){var r=n(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("");return decodeURIComponent(r)}};function i(e){return parseInt(e,16)}var a={get:function(e){var r=new RegExp("(?:(?:^|.*;\\s*)".concat(e,"\\s*\\=\\s*([^;]*).*$)|^.*$"));return document.cookie.replace(r,"$1")},set:function(r,t,n){var o=r+"="+t;if(n)for(var i in n){var a=n[i]?"=".concat(n[i]):"";o+="; ".concat(i).concat(a)}e.logger.debug("set cookie",o),document.cookie=o},remove:function(e,r){var t="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 GMT");if(r)for(var n in r)t+="; ".concat(n,"=").concat(r[n]);document.cookie=t}},c=new Set(["400","401","403","404","429","500"]),u=function(e){function t(r,t){var n=e.call(this,t)||this;return n.code=r,n}return r.__extends(t,e),t}(Error);var s=function(){function e(){this.map={}}return e.prototype.clear=function(){this.map={}},e.prototype.getItem=function(e){var r=this.map[e];return void 0===r?null:r},e.prototype.setItem=function(e,r){this.map[e]=r},e.prototype.removeItem=function(e){delete this.map[e]},e.prototype.key=function(e){var r=Object.keys(this.map)[e];return void 0===r?null:r},Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.map).length},enumerable:!1,configurable:!0}),e}();var p={parse:function(e){return e.replace(/^\?/,"").replace(/^#\/?/,"").split(/&+/).filter((function(e){return e.length>0})).reduce((function(e,t){var n=r.__read(t.split("=").map(decodeURIComponent),2),o=n[0],i=n[1],a=e[o];return Array.isArray(a)?a.push(i):Object.prototype.hasOwnProperty.call(e,o)?e[o]=[a,i]:e[o]=i,e}),{})},stringify:function(e){return Object.keys(e).map((function(r){var t=e[r],n=function(e){return void 0!==e?"".concat(encodeURIComponent(r),"=").concat(encodeURIComponent(e)):encodeURIComponent(r)};return Array.isArray(t)?t.map((function(e){return n(e)})).join("&"):n(t)})).join("&")}},f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function d(){return window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967296}function l(e){var r=new URL(e),n=r.hash.slice(1).split("&").filter((function(e){return!t.CREDENTIAL_KEYS.some((function(r){return e.includes("".concat(r,"="))}))})).join("&");return r.hash=n,r.toString()}function g(e){var t=new URL(e);return t.toString().replace(new RegExp(String.raw(v||(v=r.__makeTemplateObject(["^",""],["^",""])),t.origin)),"")}var v;exports.HTTPStatusCodes=c,exports.InMemoryStorage=s,exports.LiffError=u,exports.addParamsToUrl=function(e,t){if(!e)throw new Error("addParamsToUrl: invalid URL");var n=new URL(e);return Object.entries(t).forEach((function(e){var t=r.__read(e,2),o=t[0],i=t[1];n.searchParams.set(o,i)})),n.toString()},exports.base64Url=o,exports.compareVersion=function(e,r){if(e===r)return 0;for(var t=e.split("."),n=r.split("."),o=Math.max(t.length,n.length),i=0;i<o;i++){t[i]||(t[i]="0"),n[i]||(n[i]="0");var a=parseInt(t[i])-parseInt(n[i]);if(0!==a)return a>0?1:-1}return 0},exports.convertArgbToRgba=function(r){var t=r.replace("#","").match(/.{2}/g)||[];if(4!==t.length)return e.logger.warn("convertArgbToRgba: Received invalid ARGB color"),"";var n=function(e){var r=i(e);return Math.round(r/255*100)/100}(t[0]),o=i(t[1]),a=i(t[2]),c=i(t[3]);return"rgba(".concat(o,", ").concat(a,", ").concat(c,", ").concat(n,")")},exports.convertArrayBuffer=function(e){for(var r=e.length,t=new ArrayBuffer(r),n=new Uint8Array(t),o=0;o<r;o++)n[o]=e.charCodeAt(o);return t},exports.convertHexToRgb=function(r){var t=r.replace("#","").match(/.{2}/g)||[];if(3!==t.length)return e.logger.warn("convertArgbToRgba: Received invalid hex color"),"";var n=i(t[0]),o=i(t[1]),a=i(t[2]);return"".concat(n,", ").concat(o,", ").concat(a)},exports.cookie=a,exports.createLiffError=function(e,r){return new u(e,r||"")},exports.extractChannelIdFromLiffId=function(e){var r=e.match(/([^-]+)-[^-]+/);return r&&r[1]},exports.extractLiffId=function(e){var r,n,o=e.match((n=t.PERMANENT_LINK_ORIGIN,r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),new RegExp("^".concat(r,"(\\d+-\\w+)"))));return o&&o[1]},exports.getOriginOfUrl=function(e){var r=e.match(/^(https?:\/\/.*?)\//);return r&&r[1]||""},exports.getRandomValue=d,exports.hexToBase64=function(e){var r="";return e.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").forEach((function(e){r+=String.fromCharCode(parseInt(e))})),window.btoa(r)},exports.isIE=function(e){void 0===e&&(e=window.navigator.userAgent);var r=e.toLowerCase();return-1!==r.indexOf("msie")||-1!==r.indexOf("trident")},exports.isIpad=function(e){return void 0===e&&(e=window.navigator.userAgent),/ipad/.test(e.toLowerCase())},exports.isLIFFBrowser=function(e){return void 0===e&&(e=window.navigator.userAgent),/Line\/\d+\.\d+\.\d+ LIFF/.test(e)},exports.isLINEBrowser=function(e){return void 0===e&&(e=window.navigator.userAgent),/Line\/\d+\.\d+\.\d+/.test(e)},exports.isNonBrowserEnvironment=function(){return"undefined"==typeof window},exports.isSubWindow=function(e){return void 0===e&&(e=window.navigator.userAgent),/LIFF\/SubWindow/.test(e)},exports.qs=p,exports.randomAlphaNumericString=function(e){for(var r="",t=0;t<e;t++)r+=f[Math.floor(d()*f.length)];return r},exports.removeCredential=l,exports.removeOrigin=g,exports.replaceUrlCredentialRemoved=function(e){var r=g(l(e));window.history.replaceState(history.state,"",r)};
